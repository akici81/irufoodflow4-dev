(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[883],{1473:function(e,t,a){Promise.resolve().then(a.bind(a,9497))},5561:function(e,t,a){"use strict";a.d(t,{Z:function(){return d}});var r=a(7821),i=a(4233),n=a(168),s=a(8078),l=a(4786);let o={admin:[{name:" Ana Sayfa",path:"/admin"},{name:" \xdcr\xfcn Havuzu",path:"/urun-havuzu"},{name:" Re\xe7ete Havuzu",path:"/receteler"},{name:" Kullanıcılar",path:"/kullanicilar"},{name:" Dersler",path:"/dersler"},{name:" Alışveriş Listeleri",path:"/siparisler"},{name:" Sipariş Y\xf6netimi",path:"/siparis-yonetimi"}],ogretmen:[{name:" Ana Sayfa",path:"/ogretmen"},{name:" \xdcr\xfcn Havuzu",path:"/urun-havuzu"},{name:" Re\xe7ete Havuzu",path:"/receteler"},{name:" Alışveriş Listelerim",path:"/alisveris-listelerim"},{name:" Siparişlerim",path:"/siparislerim"},{name:" Talep Oluştur",path:"/talep"}],satin_alma:[{name:" Ana Sayfa",path:"/satin"}],stok:[{name:" Ana Sayfa",path:"/stok"}],bolum_baskani:[{name:" Ana Sayfa",path:"/bolum-baskani"},{name:" Ders Y\xf6netimi",path:"/dersler"}]};function d(e){var t;let{children:a,title:d,subtitle:c}=e,m=(0,n.usePathname)(),u=(0,n.useRouter)(),[x,p]=(0,s.useState)(null),[h,g]=(0,s.useState)(!1);if((0,s.useEffect)(()=>{(async()=>{let e=localStorage.getItem("aktifKullaniciId");if(!e){u.push("/");return}let{data:t,error:a}=await l.O.from("kullanicilar").select("id, username, ad_soyad, role").eq("id",e).single();if(a||!t){u.push("/");return}p(t)})()},[u]),!x)return null;let b=null!==(t=o[x.role])&&void 0!==t?t:[],f=(x.ad_soyad||x.username).split(" ").map(e=>e[0]).join("").slice(0,2).toUpperCase();return(0,r.jsxs)("div",{className:"min-h-screen flex bg-gray-100",children:[(0,r.jsx)("button",{onClick:()=>g(!h),className:"lg:hidden fixed top-4 right-4 z-50 bg-red-700 text-white p-3 rounded-lg shadow-lg",children:""}),h&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden",onClick:()=>g(!1)}),(0,r.jsxs)("aside",{className:"w-64 bg-white border-r border-gray-200 flex flex-col shadow-sm flex-shrink-0 fixed lg:static h-screen z-40 transition-transform duration-300 ".concat(h?"translate-x-0":"-translate-x-full lg:translate-x-0"),children:[(0,r.jsx)("div",{className:"px-6 py-5 border-b border-gray-100",children:(0,r.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-red-700 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,r.jsx)("span",{className:"text-white text-xs font-bold",children:"İR\xdc"})}),(0,r.jsx)("span",{className:"font-bold text-gray-800",children:"İR\xdcFoodFlow"})]})}),(0,r.jsx)("nav",{className:"flex-1 px-3 py-4 space-y-0.5",children:b.map(e=>{let t=m===e.path;return(0,r.jsx)(i.default,{href:e.path,className:"flex items-center px-4 py-2.5 rounded-xl text-sm transition-all ".concat(t?"bg-red-50 text-red-700 font-semibold":"text-gray-500 hover:bg-gray-100 hover:text-gray-800"),children:e.name},e.path)})}),(0,r.jsxs)("div",{className:"px-4 py-4 border-t border-gray-100",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,r.jsx)("div",{className:"w-9 h-9 bg-red-700 rounded-full flex items-center justify-center flex-shrink-0",children:(0,r.jsx)("span",{className:"text-white text-xs font-bold",children:f})}),(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsx)("p",{className:"text-sm font-semibold text-gray-800 truncate",children:x.ad_soyad||x.username}),(0,r.jsx)("p",{className:"text-xs text-gray-400",children:x.role})]})]}),(0,r.jsx)("button",{onClick:()=>{localStorage.removeItem("aktifKullaniciId"),localStorage.removeItem("role"),localStorage.removeItem("username"),u.push("/")},className:"w-full text-sm text-red-600 hover:text-red-700 font-medium py-2 rounded-xl hover:bg-red-50 transition",children:"\xc7ıkış Yap"})]})]}),(0,r.jsxs)("main",{className:"flex-1 flex flex-col overflow-auto pt-16 lg:pt-0",children:[d&&(0,r.jsxs)("div",{className:"bg-red-700 text-white px-10 py-7 flex-shrink-0",children:[c&&(0,r.jsx)("p",{className:"text-red-300 text-xs font-medium uppercase tracking-widest mb-1",children:c}),(0,r.jsx)("h1",{className:"text-2xl font-bold",children:d})]}),(0,r.jsx)("div",{className:"flex-1 p-8",children:a})]})]})}},7951:function(e,t,a){"use strict";a.d(t,{a:function(){return s}});var r=a(8078),i=a(168);let n={"/admin":["admin"],"/kullanicilar":["admin"],"/dersler":["admin","bolum_baskani"],"/siparisler":["admin"],"/siparis-yonetimi":["admin"],"/urun-havuzu":["admin","ogretmen"],"/receteler":["admin","ogretmen"],"/bolum-baskani":["admin","bolum_baskani"],"/ogretmen":["admin","ogretmen"],"/alisveris-listelerim":["admin","ogretmen"],"/siparislerim":["admin","ogretmen"],"/talep":["admin","ogretmen"],"/satin":["admin","satin_alma"],"/stok":["admin","stok"]};function s(e){let t=(0,i.useRouter)(),[a,s]=(0,r.useState)(!1),[l,o]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{let a=localStorage.getItem("aktifKullaniciId"),r=localStorage.getItem("role");if(!a||!r){t.replace("/");return}let i=n[e];if(!i){s(!0),o(!1);return}i.includes(r)?(s(!0),o(!1)):t.replace({admin:"/admin",ogretmen:"/ogretmen",satin_alma:"/satin",stok:"/stok",bolum_baskani:"/bolum-baskani"}[r]||"/")},[e,t]),{yetkili:a,yukleniyor:l}}},9497:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var r=a(7821),i=a(8078),n=a(5561),s=a(7951),l=a(4786);function o(){let{yetkili:e,yukleniyor:t}=(0,s.a)("/satin");if(t)return(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center text-gray-400",children:"Y\xfckleniyor..."});if(!e)return null;let[o,d]=(0,i.useState)([]),[c,m]=(0,i.useState)({}),[u,x]=(0,i.useState)([]),[p,h]=(0,i.useState)("tumu"),[g,b]=(0,i.useState)("tumu"),[f,k]=(0,i.useState)(null);(0,i.useEffect)(()=>{y()},[]);let y=async()=>{let[{data:e},{data:t}]=await Promise.all([l.O.from("siparisler").select("*"),l.O.from("urunler").select("id, urun_adi, marka, stok, kategori")]);d((e||[]).map(e=>({id:e.id,ogretmenAdi:e.ogretmen_adi,dersAdi:e.ders_adi,hafta:e.hafta,urunler:e.urunler||[],genelToplam:e.genel_toplam})));let a={};(t||[]).forEach(e=>{var t;a["".concat(e.urun_adi,"__").concat(e.marka||"")]={id:e.id,stok:null!==(t=e.stok)&&void 0!==t?t:0,kategori:e.kategori||"Diger"}}),m(a)},j=(e,t)=>{k({tip:e,metin:t}),setTimeout(()=>k(null),3500)},N=["tumu",...Array.from(new Set(o.map(e=>e.hafta))).sort()],v=["tumu",...Array.from(new Set(o.map(e=>e.dersAdi))).sort()],w=o.filter(e=>("tumu"===p||e.hafta===p)&&("tumu"===g||e.dersAdi===g));(0,i.useEffect)(()=>{let e={};w.forEach(t=>{t.urunler.forEach(t=>{let a="".concat(t.urunAdi,"__").concat(t.marka||"","__").concat(t.olcu),r=c["".concat(t.urunAdi,"__").concat(t.marka||"")];if(!e[a]){var i;e[a]={urunAdi:t.urunAdi,marka:t.marka,olcu:t.olcu,birimFiyat:t.birimFiyat,listeMiktar:0,toplamTutar:0,depodaMiktar:null!==(i=null==r?void 0:r.stok)&&void 0!==i?i:0,satinAlinacak:0,urunId:(null==r?void 0:r.id)||null,dususYapildi:!1,kategori:(null==r?void 0:r.kategori)||"Diger"}}e[a].listeMiktar+=Number(t.miktar),e[a].toplamTutar+=Number(t.toplam)})}),Object.values(e).forEach(e=>{e.satinAlinacak=Math.max(0,e.listeMiktar-e.depodaMiktar)}),x(Object.values(e).sort((e,t)=>{let a=(e.kategori||"").localeCompare(t.kategori||"","tr");return 0!==a?a:e.urunAdi.localeCompare(t.urunAdi,"tr")}))},[o,c,p,g]);let A=async(e,t)=>{if(!e.urunId){j("hata",'"'.concat(e.urunAdi,'" \xfcr\xfcn\xfc veritabanında bulunamadı.'));return}if(e.depodaMiktar<=0){j("hata","Depoda bu \xfcr\xfcn\xfcn stoğu zaten sıfır.");return}let{error:a}=await l.O.from("urunler").update({stok:0}).eq("id",e.urunId);if(a){j("hata","Stok g\xfcncellenemedi: "+a.message);return}j("basari",'"'.concat(e.urunAdi,'": depodaki ').concat(e.depodaMiktar," ").concat(e.olcu," stoktan d\xfcş\xfcld\xfc.")),m(t=>{let a="".concat(e.urunAdi,"__").concat(e.marka||"");return{...t,[a]:{id:e.urunId,stok:0,kategori:e.kategori}}}),x(e=>e.map((e,a)=>a===t?{...e,dususYapildi:!0,depodaMiktar:0,satinAlinacak:e.listeMiktar}:e))},S=u.reduce((e,t)=>e+t.toplamTutar,0),_=u.reduce((e,t)=>e+t.birimFiyat*t.satinAlinacak,0),I=async()=>{if(0===u.length)return;let e=await Promise.all([a.e(382),a.e(181)]).then(a.bind(a,4723)),t=u.map(e=>({"\xdcr\xfcn Adı":e.urunAdi,Marka:e.marka||"-",Ölçü:e.olcu,"Liste Miktarı":e.listeMiktar,Depoda:e.depodaMiktar,"Satın Alınacak":e.satinAlinacak,"Birim Fiyat":e.birimFiyat||0,"Satın Alma Tutarı":(e.birimFiyat||0)*e.satinAlinacak})),r=e.utils.json_to_sheet(t),i=e.utils.book_new();e.utils.book_append_sheet(i,r,"Satın Alma");let n="tumu"===p?"Satinalma_Tum":"Satinalma_".concat(p.replace(/\s/g,"_"));e.writeFile(i,"".concat(n,".xlsx"))};return(0,r.jsx)(n.Z,{title:"Satın Alma Paneli",subtitle:"Haftalık \xfcr\xfcn \xf6zetleri ve stok karşılaştırması",children:(0,r.jsxs)("div",{className:"max-w-6xl space-y-5",children:[f&&(0,r.jsx)("div",{className:"text-sm rounded-xl px-4 py-3 border font-medium ".concat("basari"===f.tip?"bg-emerald-50 text-emerald-700 border-emerald-200":"bg-red-50 text-red-600 border-red-200"),children:f.metin}),(0,r.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm p-5 flex flex-wrap gap-4 items-end",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs font-medium text-gray-700 block mb-1",children:"Hafta"}),(0,r.jsx)("select",{value:p,onChange:e=>h(e.target.value),className:"border border-gray-300 rounded-xl px-4 py-2.5 text-sm text-black bg-white focus:outline-none focus:ring-2 focus:ring-red-500",children:N.map(e=>(0,r.jsx)("option",{value:e,children:"tumu"===e?"T\xfcm Haftalar":e},e))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs font-medium text-gray-700 block mb-1",children:"Ders"}),(0,r.jsx)("select",{value:g,onChange:e=>b(e.target.value),className:"border border-gray-300 rounded-xl px-4 py-2.5 text-sm text-black bg-white focus:outline-none focus:ring-2 focus:ring-red-500 min-w-[220px]",children:v.map(e=>(0,r.jsx)("option",{value:e,children:"tumu"===e?"T\xfcm Dersler":e},e))})]}),(0,r.jsxs)("div",{className:"ml-auto flex items-end gap-3",children:[(0,r.jsx)("button",{type:"button",onClick:()=>{if(0===u.length)return;let e={};u.forEach(t=>{let a=t.kategori||"Diger";e[a]||(e[a]=[]),e[a].push(t)});let t="tumu"===p?"Tum Haftalar":p,a="tumu"===g?"Tum Dersler":g,r=new Date().toLocaleDateString("tr-TR"),i='<!DOCTYPE html><html><head><meta charset="UTF-8"><style>body{font-family:Arial,sans-serif;font-size:11px;margin:20px;color:#222}h1{font-size:14px;color:#8B0000;border-bottom:2px solid #8B0000;padding-bottom:6px;margin-bottom:4px}.meta{font-size:10px;color:#666;margin-bottom:16px}.kat{background:#f3f4f6;font-size:10px;font-weight:bold;text-transform:uppercase;letter-spacing:.05em;color:#555;padding:6px 8px;margin-top:14px;border-left:3px solid #8B0000}table{width:100%;border-collapse:collapse;margin-top:4px}th{background:#8B0000;color:white;padding:5px 8px;font-size:10px;text-align:left}td{padding:5px 8px;border-bottom:1px solid #eee;font-size:10px}tr:nth-child(even) td{background:#fafafa}.s{color:#059669;font-weight:bold}.d{color:#d97706}.y{color:#aaa}.footer{margin-top:20px;font-size:9px;color:#aaa;border-top:1px solid #eee;padding-top:6px}@media print{body{margin:10px}}</style></head><body>';i+="<h1>Satin Alma Listesi — ".concat(t,'</h1><div class="meta">').concat(a," | ").concat(r,"</div>"),Object.entries(e).forEach(e=>{let[t,a]=e;i+='<div class="kat">'.concat(t," (").concat(a.length," urun)</div><table><thead><tr><th>Urun</th><th>Marka</th><th>Satin Alinacak</th><th>B.Fiyat</th></tr></thead><tbody>"),a.forEach(e=>{let t=e.satinAlinacak>0?'<span class="s">'.concat(e.satinAlinacak," ").concat(e.olcu,"</span>"):'<span class="y">Depoda yeterli</span>';e.depodaMiktar>0&&'<span class="d">'.concat(e.depodaMiktar," ").concat(e.olcu,"</span>"),i+="<tr><td>".concat(e.urunAdi,"</td><td>").concat(e.marka||"—","</td><td>").concat(t,"</td><td>").concat(e.birimFiyat>0?"₺"+e.birimFiyat.toFixed(2):"—","</td></tr>")}),i+="</tbody></table>"});let n=u.reduce((e,t)=>e+t.birimFiyat*t.satinAlinacak,0);i+='<div style="margin-top:16px;text-align:right;font-size:12px;font-weight:bold;border-top:2px solid #8B0000;padding-top:8px;color:#8B0000;">TOPLAM: ₺'.concat(n.toLocaleString("tr-TR",{minimumFractionDigits:2}),"</div>")+'<div class="footer">IRUFoodFlow | '.concat(r,"</div></body></html>");let s=window.open("","_blank");s&&(s.document.write(i),s.document.close(),s.focus(),setTimeout(()=>{s.print()},400))},disabled:0===u.length,className:"bg-red-700 hover:bg-red-800 text-white text-sm font-semibold px-5 py-2.5 rounded-xl transition disabled:opacity-40",children:"PDF"}),(0,r.jsx)("button",{type:"button",onClick:I,disabled:0===u.length,className:"bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-semibold px-5 py-2.5 rounded-xl transition disabled:opacity-40",children:"Excel"})]})]}),u.length>0&&(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm p-5 text-center",children:[(0,r.jsx)("p",{className:"text-xs text-gray-400 font-medium uppercase tracking-wider mb-1",children:"Liste Toplamı"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-800",children:S>0?"₺".concat(S.toLocaleString("tr-TR",{minimumFractionDigits:2})):"—"})]}),(0,r.jsxs)("div",{className:"bg-white rounded-2xl border border-emerald-200 shadow-sm p-5 text-center",children:[(0,r.jsx)("p",{className:"text-xs text-gray-400 font-medium uppercase tracking-wider mb-1",children:"Satın Alınacak Tutar"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-emerald-700",children:_>0?"₺".concat(_.toLocaleString("tr-TR",{minimumFractionDigits:2})):"—"})]})]}),(0,r.jsx)("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:0===u.length?(0,r.jsx)("div",{className:"py-20 text-center text-gray-400 text-sm",children:0===o.length?"Hen\xfcz sipariş bulunmuyor.":"Bu filtreye uygun veri yok."}):(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-gray-50 border-b border-gray-100 text-left",children:[(0,r.jsx)("th",{className:"px-4 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"\xdcR\xdcN"}),(0,r.jsx)("th",{className:"px-4 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"MARKA"}),(0,r.jsx)("th",{className:"px-4 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"LİSTE MİKT."}),(0,r.jsx)("th",{className:"px-4 py-3 text-xs font-semibold text-amber-600 uppercase tracking-wider",children:"DEPODA"}),(0,r.jsx)("th",{className:"px-4 py-3 text-xs font-semibold text-emerald-600 uppercase tracking-wider",children:"SATIN ALINACAK"}),(0,r.jsx)("th",{className:"px-4 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"B.FİYAT"}),(0,r.jsx)("th",{className:"px-4 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"İŞLEM"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-gray-50",children:(()=>{let e={};return u.forEach((t,a)=>{let r=t.kategori||"Diger";e[r]||(e[r]=[]),e[r].push({satir:t,idx:a})}),Object.entries(e).flatMap(e=>{let[t,a]=e;return[(0,r.jsx)("tr",{className:"bg-gray-100 border-t-2 border-gray-200",children:(0,r.jsxs)("td",{colSpan:7,className:"px-4 py-2",children:[(0,r.jsx)("span",{className:"text-xs font-bold text-gray-600 uppercase tracking-wider",children:t}),(0,r.jsxs)("span",{className:"ml-2 text-xs text-gray-400",children:["(",a.length," \xfcr\xfcn)"]})]})},"kat-".concat(t)),...a.map(e=>{let{satir:t,idx:a}=e;return(0,r.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors ".concat(t.dususYapildi?"bg-emerald-50":""),children:[(0,r.jsx)("td",{className:"px-4 py-3.5 font-medium text-gray-800",children:t.urunAdi}),(0,r.jsx)("td",{className:"px-4 py-3.5 text-gray-500",children:t.marka||"—"}),(0,r.jsxs)("td",{className:"px-4 py-3.5 text-gray-700 font-medium",children:[t.listeMiktar," ",t.olcu]}),(0,r.jsx)("td",{className:"px-4 py-3.5",children:(0,r.jsx)("span",{className:"font-semibold ".concat(t.depodaMiktar>0?"text-amber-600":"text-gray-400"),children:t.depodaMiktar>0?"".concat(t.depodaMiktar," ").concat(t.olcu):"—"})}),(0,r.jsx)("td",{className:"px-4 py-3.5",children:(0,r.jsx)("span",{className:"font-bold text-base ".concat(t.satinAlinacak>0?"text-emerald-700":"text-gray-400"),children:t.satinAlinacak>0?"".concat(t.satinAlinacak," ").concat(t.olcu):"Depoda yeterli"})}),(0,r.jsx)("td",{className:"px-4 py-3.5 text-gray-500",children:t.birimFiyat>0?"₺".concat(t.birimFiyat.toLocaleString("tr-TR",{minimumFractionDigits:2})):"—"}),(0,r.jsx)("td",{className:"px-4 py-3.5",children:t.dususYapildi?(0,r.jsx)("span",{className:"text-xs text-emerald-600 font-medium",children:"D\xfcş\xfcld\xfc"}):t.depodaMiktar>0?(0,r.jsx)("button",{onClick:()=>A(t,a),className:"text-xs bg-orange-50 hover:bg-orange-100 text-orange-700 font-medium px-3 py-1.5 rounded-lg transition whitespace-nowrap",children:"Stoktan D\xfcş"}):(0,r.jsx)("span",{className:"text-xs text-gray-400",children:"Stok yok"})})]},a)})]})})()})]})})]})})}},4786:function(e,t,a){"use strict";a.d(t,{O:function(){return r}});let r=(0,a(5674).eI)("https://dyqbddyenmrzjjhkperf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR5cWJkZHllbm1yempqaGtwZXJmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4NzU1MjcsImV4cCI6MjA4NzQ1MTUyN30.D83dK9y-GkVLYmfon94afTNGaffiZ1S1TCNy5Ug-Io4")}},function(e){e.O(0,[135,233,115,205,744],function(){return e(e.s=1473)}),_N_E=e.O()}]);